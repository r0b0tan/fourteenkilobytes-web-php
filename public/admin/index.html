<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - fourteenkilobytes</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Dashboard -->
  <div id="dashboard-view" class="hidden">
    <!-- Use semantic header element for better document structure -->
    <header class="header">
      <div class="header-top">
        <!-- Logo with improved accessibility -->
         <div class="logo-container">
        <a href="index.html" class="logo" aria-label="14KB Dashboard">
          <!-- SVG uses currentColor to inherit accent from CSS -->
          <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="32" height="32"
            viewBox="0 0 191.000000 191.000000" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
            <g transform="translate(0.000000,191.000000) scale(0.100000,-0.100000)" fill="currentColor" stroke="none">
              <path d="M406 1889 c-175 -35 -325 -178 -371 -356 -21 -81 -22 -1071 -1 -1149
47 -176 194 -315 374 -353 61 -13 1058 -16 1066 -3 2 4 -22 29 -55 55 -67 54
-152 157 -220 265 -24 39 -46 71 -49 72 -3 0 -18 -21 -34 -46 -41 -65 -64 -78
-116 -64 -63 17 -74 3 -65 -82 5 -57 4 -69 -10 -74 -24 -10 -45 15 -45 54 0
34 -1 34 -19 18 -10 -9 -21 -31 -25 -47 -5 -26 -10 -30 -33 -27 -23 2 -29 8
-31 35 -3 27 1 35 22 44 26 12 40 35 30 50 -9 16 -22 10 -58 -27 -40 -41 -72
-40 -82 2 -8 31 5 46 54 59 49 14 52 37 7 54 -19 7 -40 9 -45 6 -29 -18 -54
47 -28 73 17 17 35 15 66 -8 15 -12 41 -22 57 -23 28 -2 30 0 27 28 -8 85 -7
89 12 93 24 5 46 -23 46 -58 0 -37 29 -60 75 -60 51 0 69 18 101 106 l27 74
-19 42 c-26 59 -98 111 -196 143 -68 23 -91 36 -129 75 -58 59 -82 121 -109
278 -33 194 -24 242 44 242 36 0 242 -68 310 -102 87 -43 125 -102 140 -218 9
-60 39 -108 79 -125 20 -8 76 -15 138 -16 57 -1 142 -8 188 -15 46 -8 87 -12
90 -9 9 10 1 84 -14 119 -8 20 -25 41 -37 47 -20 11 -25 8 -55 -27 -27 -33
-35 -37 -50 -28 -10 6 -19 22 -21 36 -2 20 5 30 33 47 45 26 37 45 -16 38 -44
-6 -75 18 -65 51 9 29 30 33 70 17 57 -24 63 -18 22 24 -40 41 -44 66 -13 85
24 15 49 -2 59 -41 4 -17 15 -36 23 -43 21 -18 31 12 17 56 -8 27 -7 37 5 49
36 37 68 5 59 -58 -5 -32 -3 -47 8 -56 11 -9 18 -6 35 16 40 54 41 54 62 42
28 -15 22 -60 -11 -76 -57 -28 -65 -87 -25 -201 28 -82 31 -131 10 -171 -16
-31 -33 -41 -71 -41 -14 0 -34 -5 -45 -11 -26 -13 -15 -27 61 -79 30 -21 91
-70 135 -109 44 -39 85 -71 92 -71 20 0 18 909 -2 1003 -15 73 -58 162 -106
221 -40 48 -135 112 -207 139 -55 21 -71 22 -587 23 -305 1 -551 -2 -579 -7z" />
            </g>
          </svg>
          <!-- Stacked wordmark for compact branding -->
          <span class="logo-text" aria-hidden="true">14<br>KB</span>
        </a></div>
        <!-- Semantic nav with improved structure -->
        <nav class="header-nav" aria-label="Main navigation">
          <a href="index.html" class="nav-icon active" aria-current="page">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            Übersicht
          </a>
          <a href="editor.html" class="nav-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <line x1="12" y1="5" x2="12" y2="19" />
              <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            Neu
          </a>
          <a href="settings.html" class="nav-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="12" cy="12" r="3" />
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
            </svg>
            Einstellungen
          </a>
          <a href="/" target="_blank" rel="noopener" class="nav-icon external-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
              <polyline points="15 3 21 3 21 9" />
              <line x1="10" y1="14" x2="21" y2="3" />
            </svg>
            Blog
          </a>
          <!-- Visual separator before logout -->
          <span class="nav-separator" aria-hidden="true"></span>
          <a href="#" id="logout-btn" class="nav-icon logout-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            Logout
          </a>
        </nav>
      </div>
      <h1 class="page-title">Übersicht</h1>
    </header>

    <!-- Content Card -->
    <div class="editor-card">
      <div class="card-header">
        <div class="dashboard-tabs">
          <button type="button" class="tab-btn active" data-tab="posts">Posts</button>
          <button type="button" class="tab-btn" data-tab="pages">Seiten</button>
          <button type="button" class="tab-btn" data-tab="archive">Archiv</button>
        </div>
        <div class="list-controls">
          <div class="search-box">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="text" id="search-input" placeholder="Suche...">
          </div>
          <div class="date-range-picker">
            <div class="date-range-trigger" id="date-range-trigger">
              <svg class="calendar-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span id="date-range-label">Datum</span>
            </div>
            <div class="date-range-dropdown hidden" id="date-range-dropdown">
              <div class="date-range-inputs">
                <div class="date-input-group">
                  <label for="date-from">Von</label>
                  <input type="date" id="date-from" placeholder="TT.MM.JJJJ">
                </div>
                <div class="date-input-group">
                  <label for="date-to">Bis</label>
                  <input type="date" id="date-to" placeholder="TT.MM.JJJJ">
                </div>
              </div>
              <button type="button" class="btn btn-primary" id="clear-dates">Zurücksetzen</button>
            </div>
          </div>
          <div class="page-size-selector">
            <select id="page-size">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
              <option value="all">Alle</option>
            </select>
          </div>
        </div>
      </div>
      <div class="card-body">
        <!-- Posts Tab -->
        <div id="tab-posts" class="tab-content active">
          <ul id="posts-list" class="posts-list">
            <li class="empty">Lade...</li>
          </ul>
          <div id="posts-pagination" class="pagination hidden"></div>
        </div>

        <!-- Pages Tab -->
        <div id="tab-pages" class="tab-content hidden">
          <ul id="pages-list" class="posts-list">
            <li class="empty">Lade...</li>
          </ul>
          <div id="pages-pagination" class="pagination hidden"></div>
        </div>

        <!-- Archive Tab -->
        <div id="tab-archive" class="tab-content hidden">
          <ul id="archive-list" class="posts-list">
            <li class="empty">Lade...</li>
          </ul>
          <div id="archive-pagination" class="pagination hidden"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal System -->
  <div id="modal-backdrop" class="modal-backdrop hidden"></div>
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <p id="modal-message"></p>
      <div id="modal-actions" class="popup-actions"></div>
    </div>
  </div>

  <script type="module" src="app.js"></script>
  <script type="module">
    (async function () {
      const dashboardView = document.getElementById('dashboard-view');
      const logoutBtn = document.getElementById('logout-btn');
      const postsList = document.getElementById('posts-list');
      const pagesList = document.getElementById('pages-list');
      const archiveList = document.getElementById('archive-list');
      const postsPagination = document.getElementById('posts-pagination');
      const pagesPagination = document.getElementById('pages-pagination');
      const archivePagination = document.getElementById('archive-pagination');
      const pageSizeSelect = document.getElementById('page-size');
      const searchInput = document.getElementById('search-input');
      const dateFromInput = document.getElementById('date-from');
      const dateToInput = document.getElementById('date-to');
      const dateRangeTrigger = document.getElementById('date-range-trigger');
      const dateRangeDropdown = document.getElementById('date-range-dropdown');
      const dateRangeLabel = document.getElementById('date-range-label');
      const clearDatesBtn = document.getElementById('clear-dates');
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      // Pagination & Search State
      let allPosts = [];
      let allPages = [];
      let allArchive = [];
      let pageSize = 10;
      let postsPage = 1;
      let pagesPage = 1;
      let archivePage = 1;
      let searchQuery = '';
      let dateFrom = null;
      let dateTo = null;

      // Debounce helper
      function debounce(fn, delay) {
        let timeout;
        return (...args) => {
          clearTimeout(timeout);
          timeout = setTimeout(() => fn(...args), delay);
        };
      }

      // Check if setup is complete
      const status = await App.getSetupStatus();
      if (!status.setupComplete) {
        window.location.href = '/admin/setup';
        return;
      }

      // Check if auth is required
      const config = await App.getConfig();

      if (config.authEnabled) {
        // Check if logged in
        const loggedIn = await App.isLoggedIn();
        if (!loggedIn) {
          window.location.href = '/admin/login.html';
          return;
        }
      }

      // Show dashboard
      dashboardView.classList.remove('hidden');
      loadAllContent();

      // Date range picker dropdown
      dateRangeTrigger.addEventListener('click', (e) => {
        e.stopPropagation();
        dateRangeDropdown.classList.toggle('hidden');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!dateRangeTrigger.contains(e.target) && !dateRangeDropdown.contains(e.target)) {
          dateRangeDropdown.classList.add('hidden');
        }
      });

      // Update date range label
      function updateDateRangeLabel() {
        if (dateFrom && dateTo) {
          const fromFormatted = new Date(dateFrom).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
          const toFormatted = new Date(dateTo).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
          dateRangeLabel.textContent = `${fromFormatted} - ${toFormatted}`;
          dateRangeTrigger.classList.add('active');
        } else if (dateFrom) {
          const fromFormatted = new Date(dateFrom).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
          dateRangeLabel.textContent = `Ab ${fromFormatted}`;
          dateRangeTrigger.classList.add('active');
        } else if (dateTo) {
          const toFormatted = new Date(dateTo).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
          dateRangeLabel.textContent = `Bis ${toFormatted}`;
          dateRangeTrigger.classList.add('active');
        } else {
          dateRangeLabel.textContent = 'Datum';
          dateRangeTrigger.classList.remove('active');
        }
      }

      // Clear dates button
      clearDatesBtn.addEventListener('click', () => {
        dateFromInput.value = '';
        dateToInput.value = '';
        dateFrom = null;
        dateTo = null;
        postsPage = 1;
        pagesPage = 1;
        archivePage = 1;
        updateDateRangeLabel();
        renderCurrentView();
      });

      // Page size change handler
      pageSizeSelect.addEventListener('change', () => {
        pageSize = pageSizeSelect.value === 'all' ? Infinity : parseInt(pageSizeSelect.value, 10);
        postsPage = 1;
        pagesPage = 1;
        renderCurrentView();
      });

      // Search handler with debounce
      searchInput.addEventListener('input', debounce(() => {
        searchQuery = searchInput.value.trim().toLowerCase();
        postsPage = 1;
        pagesPage = 1;
        archivePage = 1;
        renderCurrentView();
      }, 200));

      // Date range handlers
      dateFromInput.addEventListener('change', () => {
        dateFrom = dateFromInput.value;
        postsPage = 1;
        pagesPage = 1;
        archivePage = 1;
        updateDateRangeLabel();
        renderCurrentView();
      });

      dateToInput.addEventListener('change', () => {
        dateTo = dateToInput.value;
        postsPage = 1;
        pagesPage = 1;
        archivePage = 1;
        updateDateRangeLabel();
        renderCurrentView();
      });

      // Logout handler
      logoutBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        await App.logout();
        window.location.href = '/admin/login.html';
      });

      // ============ MODAL SYSTEM ============

      const Modal = (() => {
        const backdrop = document.getElementById('modal-backdrop');
        const modal = document.getElementById('modal');
        const message = document.getElementById('modal-message');
        const actions = document.getElementById('modal-actions');

        function hide() {
          modal.classList.add('hidden');
          backdrop.classList.add('hidden');
          modal.className = 'modal hidden';
          actions.innerHTML = '';
        }

        function show(text, buttons, type = '') {
          message.textContent = text;
          actions.innerHTML = '';
          modal.className = 'modal' + (type ? ` modal-${type}` : '');

          buttons.forEach(btn => {
            const button = document.createElement('button');
            button.type = 'button';
            button.textContent = btn.text;
            button.className = btn.class || '';
            button.addEventListener('click', () => {
              hide();
              if (btn.action) btn.action();
            });
            actions.appendChild(button);
          });

          backdrop.classList.remove('hidden');
          modal.classList.remove('hidden');
        }

        return {
          confirm(text) {
            return new Promise(resolve => {
              show(text, [
                { text: 'Ja', class: 'btn-danger', action: () => resolve(true) },
                { text: 'Abbrechen', class: 'btn-secondary', action: () => resolve(false) }
              ]);
            });
          },

          error(text) {
            show(text, [{ text: 'OK', class: 'btn-primary' }], 'error');
          },

          hide
        };
      })();

      // ============ TABS ============

      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.dataset.tab;
          tabBtns.forEach(b => b.classList.toggle('active', b === btn));
          tabContents.forEach(c => c.classList.toggle('active', c.id === `tab-${tab}`));
          tabContents.forEach(c => c.classList.toggle('hidden', c.id !== `tab-${tab}`));
        });
      });

      async function loadAllContent() {
        try {
          const allContent = await App.getPosts();

          // Split into posts, pages, and archive (tombstones), sort by date
          allPosts = allContent
            .filter(item => item.pageType !== 'page' && item.status !== 'tombstone')
            .sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));

          allPages = allContent
            .filter(item => item.pageType === 'page' && item.status !== 'tombstone')
            .sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));

          allArchive = allContent
            .filter(item => item.status === 'tombstone')
            .sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));

          renderCurrentView();
        } catch (err) {
          postsList.innerHTML = '<li class="empty">Fehler beim Laden</li>';
          pagesList.innerHTML = '<li class="empty">Fehler beim Laden</li>';
          archiveList.innerHTML = '<li class="empty">Fehler beim Laden</li>';
          console.error(err);
        }
      }

      function filterItems(items) {
        return items.filter(item => {
          // Text search filter (title and slug)
          if (searchQuery) {
            const query = searchQuery.toLowerCase();
            const matchesText = item.title.toLowerCase().includes(query) || 
                                item.slug.toLowerCase().includes(query);
            if (!matchesText) return false;
          }
          
          // Date range filter
          if (dateFrom || dateTo) {
            if (!item.publishedAt) return false;
            
            const itemDate = new Date(item.publishedAt);
            itemDate.setHours(0, 0, 0, 0); // Normalize to midnight for comparison
            
            if (dateFrom) {
              const fromDate = new Date(dateFrom);
              fromDate.setHours(0, 0, 0, 0);
              if (itemDate < fromDate) return false;
            }
            
            if (dateTo) {
              const toDate = new Date(dateTo);
              toDate.setHours(23, 59, 59, 999); // End of day
              if (itemDate > toDate) return false;
            }
          }
          
          return true;
        });
      }

      function renderCurrentView() {
        const filteredPosts = filterItems(allPosts);
        const filteredPages = filterItems(allPages);
        const filteredArchive = filterItems(allArchive);
        renderPaginatedList(postsList, postsPagination, filteredPosts, postsPage, 'Post', 'Noch keine Posts.', (p) => { postsPage = p; renderCurrentView(); });
        renderPaginatedList(pagesList, pagesPagination, filteredPages, pagesPage, 'Seite', 'Noch keine Seiten.', (p) => { pagesPage = p; renderCurrentView(); });
        renderPaginatedList(archiveList, archivePagination, filteredArchive, archivePage, '', 'Keine gelöschten Artikel.', (p) => { archivePage = p; renderCurrentView(); });
      }

      function renderPaginatedList(listEl, paginationEl, items, currentPage, typeName, emptyText, onPageChange) {
        if (items.length === 0) {
          listEl.innerHTML = `<li class="empty">${emptyText} <a href="editor.html">Erstelle deine erste ${typeName}</a></li>`;
          paginationEl.classList.add('hidden');
          return;
        }

        const totalItems = items.length;
        const effectivePageSize = pageSize === Infinity ? totalItems : pageSize;
        const totalPages = Math.ceil(totalItems / effectivePageSize);
        const safeCurrentPage = Math.min(currentPage, totalPages);
        const startIndex = (safeCurrentPage - 1) * effectivePageSize;
        const endIndex = Math.min(startIndex + effectivePageSize, totalItems);
        const pageItems = items.slice(startIndex, endIndex);

        listEl.innerHTML = pageItems.map(item => `
          <li>
            <div class="post-info">
              <div class="post-title ${item.status === 'tombstone' ? 'status-tombstone' : ''}">
                <a href="/${item.slug}" target="_blank">${App.escapeHtml(item.title)}</a>
              </div>
              <div class="post-meta">
                /${item.slug} · ${App.formatDate(item.publishedAt)}
                ${item.status === 'tombstone' ? ' · <span class="text-muted">gelöscht</span>' : ''}
              </div>
            </div>
            <div class="post-actions">
              <a href="/${item.slug}" target="_blank" class="btn btn-secondary btn-small btn-icon">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                Ansehen
              </a>
              ${item.status === 'published' ? `
                <button class="btn btn-secondary btn-small btn-icon" onclick="recompilePost('${item.slug}')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
                  Recompile
                </button>
                <button class="btn btn-secondary btn-small btn-icon" onclick="duplicatePost('${item.slug}')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                  Duplizieren
                </button>
                <span class="action-separator"></span>
                <button class="btn btn-danger btn-small btn-icon" onclick="deletePost('${item.slug}')">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                  Löschen
                </button>
              ` : ''}
            </div>
          </li>
        `).join('');

        // Render pagination
        if (totalPages <= 1) {
          paginationEl.classList.add('hidden');
          return;
        }

        paginationEl.classList.remove('hidden');
        paginationEl.innerHTML = '';

        // Previous button
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '‹';
        prevBtn.disabled = safeCurrentPage === 1;
        prevBtn.addEventListener('click', () => onPageChange(safeCurrentPage - 1));
        paginationEl.appendChild(prevBtn);

        // Page numbers
        const maxButtons = 5;
        let startPage = Math.max(1, safeCurrentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);
        if (endPage - startPage < maxButtons - 1) {
          startPage = Math.max(1, endPage - maxButtons + 1);
        }

        if (startPage > 1) {
          const firstBtn = document.createElement('button');
          firstBtn.textContent = '1';
          firstBtn.addEventListener('click', () => onPageChange(1));
          paginationEl.appendChild(firstBtn);
          if (startPage > 2) {
            const dots = document.createElement('span');
            dots.className = 'pagination-info';
            dots.textContent = '…';
            paginationEl.appendChild(dots);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button');
          btn.textContent = i;
          btn.className = i === safeCurrentPage ? 'active' : '';
          btn.addEventListener('click', () => onPageChange(i));
          paginationEl.appendChild(btn);
        }

        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const dots = document.createElement('span');
            dots.className = 'pagination-info';
            dots.textContent = '…';
            paginationEl.appendChild(dots);
          }
          const lastBtn = document.createElement('button');
          lastBtn.textContent = totalPages;
          lastBtn.addEventListener('click', () => onPageChange(totalPages));
          paginationEl.appendChild(lastBtn);
        }

        // Next button
        const nextBtn = document.createElement('button');
        nextBtn.textContent = '›';
        nextBtn.disabled = safeCurrentPage === totalPages;
        nextBtn.addEventListener('click', () => onPageChange(safeCurrentPage + 1));
        paginationEl.appendChild(nextBtn);
      }

      // Global delete handler
      window.deletePost = async function (slug) {
        const confirmed = await Modal.confirm(`"${slug}" wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.`);
        if (!confirmed) return;

        try {
          await App.deletePost(slug);
          loadAllContent();
        } catch (err) {
          Modal.error('Fehler beim Löschen: ' + err.message);
        }
      };

      // Global recompile handler - opens editor with source
      window.recompilePost = function (slug) {
        window.location.href = `editor.html?edit=${encodeURIComponent(slug)}`;
      };

      // Global duplicate handler - clones page and opens editor
      window.duplicatePost = async function (slug) {
        try {
          const { sourceData } = await App.clonePage(slug, 'page');
          // Store cloned data in sessionStorage to pass to editor
          sessionStorage.setItem('clonedSource', JSON.stringify(sourceData));
          window.location.href = 'editor.html?clone=true';
        } catch (err) {
          Modal.error('Fehler beim Duplizieren: ' + err.message);
        }
      };
    })();
  </script>
</body>

</html>